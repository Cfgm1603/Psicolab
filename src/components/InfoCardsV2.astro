---
interface Props {
  title: string;
  description: string;
  imageSrc: string;
  imageAlt: string;
}

const { title, description, imageSrc, imageAlt } = Astro.props;
---

<div class="expanding-card bg-white rounded-3xl overflow-hidden shadow-md">
  <div class="card-content px-4 py-2">
    <div class="px-3 py-2">
      <h2
        class="text-xl md:text-2xl font-bold text-[#061d56] line-clamp-2 md:line-clamp-2"
      >
        {title}
      </h2>
    </div>
    <div class="overflow-hidden rounded-3xl">
      <img
        src={imageSrc || "/placeholder.svg"}
        alt={imageAlt}
        class="w-full h-[120px] md:h-[150px] object-cover"
      />
    </div>
    <div class="expand-indicator">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="currentColor"
        class="w-6 h-6"
      >
        <path
          fill-rule="evenodd"
          d="M12.53 16.28a.75.75 0 01-1.06 0l-6-6a.75.75 0 011.06-1.06L12 14.69l5.47-5.47a.75.75 0 111.06 1.06l-6 6z"
          clip-rule="evenodd"></path>
      </svg>
    </div>
    <div class="description-container bg-white">
      <div class="p-1 md:p-2">
        <p
          class="text-base md:text-lg text-gray-700 description leading-relaxed"
        >
          {description}
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  .expanding-card {
    height: auto; /* Permitir altura automática inicial */
    min-height: 220px; /* Altura mínima para mobile */
    max-height: 300px; /* Altura máxima inicial */
    transition: max-height 0.3s ease-in-out;
    margin-bottom: 1rem;
    position: relative;
  }

  @media (min-width: 768px) {
    .expanding-card {
      min-height: 250px; /* Altura mínima para pantallas más grandes */
      max-height: 320px; /* Altura máxima inicial para desktop */
    }
  }

  .expanding-card.expanded {
    max-height: 2000px; /* Valor alto para permitir cualquier contenido */
  }

  .card-content {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .expand-indicator {
    display: flex;
    justify-content: center;
    color: #061d56;
    opacity: 0.7;
    margin-top: 0.5rem;
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  .expanding-card.expanded .expand-indicator {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
  }

  .description-container {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }

  .expanding-card.expanded .description-container {
    max-height: 1000px;
  }

  .description {
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  .expanding-card.expanded .description {
    opacity: 1;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".expanding-card");

    // Ajustar altura inicial según contenido del título
    cards.forEach((card) => {
      const titleElement = card.querySelector("h2");
      const imageElement = card.querySelector("img");

      // Detectar si el título ocupa más de una línea y ajustar altura
      function adjustCardHeight() {
        const titleHeight = titleElement.offsetHeight;
        const standardTitleHeight = 32; // Altura aproximada de una línea de título

        if (titleHeight > standardTitleHeight) {
          // Ajustar la altura de la tarjeta según necesidad
          const extraHeight = titleHeight - standardTitleHeight;
          card.style.minHeight = `calc(${card.offsetHeight}px + ${extraHeight}px)`;
        }
      }

      // Ejecutar después de que las imágenes se carguen
      if (imageElement.complete) {
        adjustCardHeight();
      } else {
        imageElement.onload = adjustCardHeight;
      }
    });

    cards.forEach((card) => {
      // Evento para desktop (hover)
      card.addEventListener("mouseenter", () => {
        card.classList.add("expanded");
      });

      // Evento para dispositivos táctiles (tap/touch)
      card.addEventListener("click", () => {
        // Si ya está expandida, no hacemos nada (para mantenerla expandida)
        if (!card.classList.contains("expanded")) {
          card.classList.add("expanded");
        }
      });

      // Soporte para dispositivos táctiles
      card.addEventListener(
        "touchstart",
        (e) => {
          if (window.matchMedia("(pointer: coarse)").matches) {
            e.preventDefault();
            if (!card.classList.contains("expanded")) {
              card.classList.add("expanded");
            }
          }
        },
        { passive: false }
      );
    });
  });
</script>
